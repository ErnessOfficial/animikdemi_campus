import type { Course } from '../../types';
import { mockInstructor } from './courseData';
import { assetPath } from '../../utils/paths';

export const course: Course = {
  "id": "la-higiene-del-sueo-y-el-bienestar-emocional",
  "title": "La Higiene del Sue√±o y el Bienestar Emocional",
  "subtitle": "C√≥mo descansar mejor para vivir con m√°s equilibrio interior",
  "description": "Este curso te invita a explorar la relaci√≥n entre tus h√°bitos de sue√±o y tu bienestar emocional. A trav√©s de lecturas claras, recursos interactivos y ejercicios reflexivos, aprender√°s a reconocer la importancia del descanso, implementar rutinas saludables y dise√±ar un plan de sue√±o adaptado a tu vida. Un recorrido que combina ciencia, pr√°ctica y emociones para transformar tus noches y tus d√≠as.\n",
  "category": "Sue√±o & Descanso consciente",
  "broadCategories": [],
  "coverImage": assetPath('images/la-higiene-del-sueo-y-el-bienestar-emocional_portada.png'),
  "instructor": mockInstructor,
  "learningObjectives": [
    "Comprender la funci√≥n del sue√±o y su impacto en la salud integral.",
    "Identificar h√°bitos y factores que favorecen o alteran la higiene del sue√±o.",
    "Reconocer la relaci√≥n entre el sue√±o y las emociones.",
    "Aplicar t√©cnicas de relajaci√≥n y mindfulness para mejorar la calidad del descanso.",
    "Dise√±ar un plan personal de bienestar nocturno que integre h√°bitos saludables y autorregulaci√≥n emocional."
  ],
  "modules": [
    {
      "id": "m1",
      "title": "El sue√±o como pilar de la salud integral",
      "activities": [
        {
          "id": "m1a1",
          "title": "Lectura: Importancia biol√≥gica y psicol√≥gica del sue√±o",
          "description": "Importancia biol√≥gica y psicol√≥gica del sue√±o",
          "type": "quiz",
          "questions": [
            {
              "question": "¬øTu entorno favorece el descanso?",
              "options": [
                { "text": "S√≠: oscuro, fresco y silencioso.", "feedback": "Condiciones √≥ptimas para el sue√±o profundo." },
                { "text": "Mejorable en uno o dos aspectos.", "feedback": "Peque√±os ajustes pueden tener gran impacto." },
                { "text": "No, suele haber luz/ruido/calor.", "feedback": "Prioriza cambios ambientales graduales." }
              ]
            },
            {
              "question": "¬øQu√© haces si no puedes dormir?",
              "options": [
                { "text": "Me levanto y hago algo relajante.", "feedback": "Buen manejo: evita asociar la cama con vigilia." },
                { "text": "Me quedo en cama mirando el m√≥vil.", "feedback": "La luz y el est√≠mulo dificultan conciliar." },
                { "text": "Como o tomo cafe√≠na.", "feedback": "Puede empeorar la latencia del sue√±o." }
              ]
            }
          ],
          "content": [
            "Ciclos del sue√±o y su influencia en la mente y el cuerpo.El sue√±o es una funci√≥n biol√≥gica fundamental que desempe√±a un papel crucial en nuestra salud f√≠sica y mental. Va mucho m√°s all√° del simple descanso, siendo un proceso activo y complejo con una profunda importancia biol√≥gica y psicol√≥gica.\nDesde una perspectiva biol√≥gica, el sue√±o es esencial para la restauraci√≥n y reparaci√≥n del cuerpo. Durante este per√≠odo, se llevan a cabo procesos vitales como la regeneraci√≥n celular, la consolidaci√≥n de la memoria y la liberaci√≥n de hormonas importantes para el crecimiento y la regulaci√≥n del metabolismo. Un sue√±o adecuado fortalece el sistema inmunol√≥gico, ayudando al cuerpo a combatir infecciones y enfermedades. La privaci√≥n cr√≥nica del sue√±o, por otro lado, puede conducir a una serie de problemas de salud, incluyendo enfermedades cardiovasculares, diabetes y obesidad.",
            "Psicol√≥gicamente, el sue√±o es igualmente indispensable. Durante el sue√±o, especialmente en las etapas m√°s profundas, el cerebro procesa y consolida la informaci√≥n adquirida durante el d√≠a, lo que es vital para el aprendizaje y la memoria. Tambi√©n es un momento crucial para la regulaci√≥n emocional. Un sue√±o reparador contribuye a mejorar el estado de √°nimo, reducir el estr√©s y la ansiedad, y potenciar la capacidad de resoluci√≥n de problemas. La falta de sue√±o puede manifestarse en irritabilidad, dificultad para concentrarse y un deterioro en el rendimiento cognitivo.\nEl sue√±o no es un estado uniforme, sino que se divide en ciclos que se repiten varias veces a lo largo de la noche. Cada ciclo consta de diferentes etapas, incluyendo el sue√±o REM (Movimiento Ocular R√°pido) y las etapas de sue√±o no REM. El sue√±o no REM se subdivide a su vez en sue√±o ligero y sue√±o profundo.\nLos ciclos del sue√±o influyen significativamente en la mente y el cuerpo. Durante las etapas de sue√±o profundo no REM, el cuerpo se repara y se fortalece f√≠sicamente. En contraste, la etapa REM es donde ocurre la mayor√≠a de los sue√±os v√≠vidos y es crucial para el procesamiento emocional y la consolidaci√≥n de la memoria. Interrupciones en cualquiera de estas etapas pueden tener consecuencias negativas, afectando la calidad del descanso y, por ende, la capacidad del cuerpo y la mente para funcionar √≥ptimamente al d√≠a siguiente.\nEn resumen, el sue√±o es mucho m√°s que un simple acto de inactividad; es un pilar fundamental para nuestro bienestar integral. Comprender su importancia biol√≥gica y psicol√≥gica, as√≠ como el funcionamiento de sus ciclos, nos permite apreciar la necesidad de priorizar un sue√±o de calidad para mantener un equilibrio saludable entre nuestra mente y nuestro cuerpo.\n"
          ]
        },
        {
          "id": "m1a2",
          "title": "‚ÄúUn viaje al cerebro mientras dormimos‚Äù.",
          "description": "Video animado explicativo:",
          "type": "video",
          "videoSrc": assetPath('videos/higiene-sueno_mod1_01.mp4')
        },
        {
          "id": "m1a3",
          "title": "Diario inicial: ‚ÄúMis h√°bitos de sue√±o y c√≥mo me siento al despertar‚Äù.",
          "description": "Actividad reflexiva: Diario inicial",
          "type": "iframe",
          "content": [
            "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Mis h√°bitos de sue√±o y c√≥mo me siento al despertar</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n  <style>\n    @media print {\n      .no-print { display: none !important; }\n      .print\\:block { display: block !important; }\n    }\n    .chip { @apply inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm cursor-pointer transition; }\n    .chip-active { @apply bg-gray-900 text-white border-gray-900; }\n    .card { @apply bg-white/70 backdrop-blur border rounded-2xl shadow-sm; }\n  </style>\n</head>\n<body class=\"min-h-screen bg-gradient-to-br from-sky-50 via-indigo-50 to-rose-50 text-gray-900\">\n  <div class=\"max-w-5xl mx-auto p-6 md:p-10\">\n    <header class=\"mb-6\">\n      <h1 class=\"text-3xl md:text-4xl font-bold tracking-tight\">Mis h√°bitos de sue√±o y c√≥mo me siento al despertar</h1>\n      <p class=\"text-gray-600 mt-2\">Diario inicial para tomar conciencia, detectar patrones y elegir micro-h√°bitos de mejora.</p>\n      <div class=\"mt-4 flex flex-wrap items-center gap-3\">\n        <label class=\"font-medium\" for=\"entryDate\">Fecha</label>\n        <input id=\"entryDate\" type=\"date\" class=\"border rounded-xl px-3 py-2\" />\n        <button id=\"todayBtn\" class=\"no-print rounded-xl border px-3 py-2 hover:bg-white\">Hoy</button>\n        <div id=\"saveStatus\" class=\"text-sm text-gray-500\"></div>\n      </div>\n    </header>\n\n    <!-- Paso 1: Noche pasada -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h2 class=\"text-xl font-semibold\">1) Noche pasada</h2>\n        <span class=\"text-xs text-gray-500\">Campos clave para estimar horas y calidad</span>\n      </div>\n      <div class=\"grid md:grid-cols-3 gap-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"bedTime\">Hora a la que me acost√©</label>\n          <input id=\"bedTime\" type=\"time\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"wakeTime\">Hora a la que me despert√©</label>\n          <input id=\"wakeTime\" type=\"time\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"awakenings\">Despertares nocturnos</label>\n          <input id=\"awakenings\" type=\"number\" min=\"0\" step=\"1\" value=\"0\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n      </div>\n      <div class=\"grid md:grid-cols-3 gap-4 mt-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"sleepQuality\">Calidad percibida del sue√±o <span class=\"text-gray-400\">(1‚Äì10)</span></label>\n          <input id=\"sleepQuality\" type=\"range\" min=\"1\" max=\"10\" value=\"6\" class=\"w-full\" />\n          <div class=\"text-sm text-gray-600\">Valor: <span id=\"sleepQualityVal\">6</span></div>\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"sleepHours\">Horas totales estimadas</label>\n          <input id=\"sleepHours\" type=\"text\" readonly class=\"w-full border rounded-xl px-3 py-2 bg-gray-50\" placeholder=\"‚Äî\" />\n        </div>\n        <div class=\"flex items-center gap-2\">\n          <input id=\"hadDreams\" type=\"checkbox\" class=\"h-5 w-5\" />\n          <label for=\"hadDreams\" class=\"text-sm\">Recuerdo sue√±os</label>\n        </div>\n      </div>\n    </section>\n\n    <!-- Paso 2: Al despertar -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h2 class=\"text-xl font-semibold\">2) Al despertar</h2>\n        <span class=\"text-xs text-gray-500\">Estado emocional y corporal</span>\n      </div>\n      <div class=\"grid md:grid-cols-2 gap-6\">\n        <div>\n          <p class=\"text-sm font-medium mb-2\">Estado de √°nimo</p>\n          <div id=\"moodChips\" class=\"flex flex-wrap gap-2\">\n            <!-- chips generados por JS -->\n          </div>\n          <input id=\"moodHidden\" type=\"hidden\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"energy\">Energ√≠a al despertar <span class=\"text-gray-400\">(1‚Äì10)</span></label>\n          <input id=\"energy\" type=\"range\" min=\"1\" max=\"10\" value=\"6\" class=\"w-full\" />\n          <div class=\"text-sm text-gray-600\">Valor: <span id=\"energyVal\">6</span></div>\n        </div>\n      </div>\n      <div class=\"mt-4\">\n        <p class=\"text-sm font-medium mb-2\">Sensaciones corporales (marca las que apliquen)</p>\n        <div id=\"bodyChips\" class=\"flex flex-wrap gap-2\"></div>\n      </div>\n    </section>\n\n    <!-- Paso 3: H√°bitos previos -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h2 class=\"text-xl font-semibold\">3) Antes de dormir: ¬øqu√© pas√≥?</h2>\n        <span class=\"text-xs text-gray-500\">Est√≠mulos y entorno</span>\n      </div>\n      <div class=\"grid md:grid-cols-3 gap-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"caffeine\">Caf√©/te (tazas)</label>\n          <input id=\"caffeine\" type=\"number\" min=\"0\" step=\"1\" value=\"0\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"screens\">Pantallas antes de dormir (minutos)</label>\n          <input id=\"screens\" type=\"number\" min=\"0\" step=\"5\" value=\"0\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"exercise\">Ejercicio (minutos)</label>\n          <input id=\"exercise\" type=\"number\" min=\"0\" step=\"5\" value=\"0\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n      </div>\n      <div class=\"grid md:grid-cols-3 gap-4 mt-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"lateMeal\">Cena tard√≠a (hora aproximada)</label>\n          <input id=\"lateMeal\" type=\"time\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"alcohol\">Alcohol (unidades)</label>\n          <input id=\"alcohol\" type=\"number\" min=\"0\" step=\"1\" value=\"0\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"stress\">Estr√©s percibido <span class=\"text-gray-400\">(1‚Äì10)</span></label>\n          <input id=\"stress\" type=\"range\" min=\"1\" max=\"10\" value=\"5\" class=\"w-full\" />\n          <div class=\"text-sm text-gray-600\">Valor: <span id=\"stressVal\">5</span></div>\n        </div>\n      </div>\n      <div class=\"mt-4 flex flex-wrap gap-2\">\n        <span class=\"text-sm font-medium mr-2\">Entorno:</span>\n        <label class=\"chip\"><input type=\"checkbox\" id=\"noise\" class=\"mr-2\"> Ruido</label>\n        <label class=\"chip\"><input type=\"checkbox\" id=\"light\" class=\"mr-2\"> Demasiada luz</label>\n        <label class=\"chip\"><input type=\"checkbox\" id=\"tempHot\" class=\"mr-2\"> Calor</label>\n        <label class=\"chip\"><input type=\"checkbox\" id=\"tempCold\" class=\"mr-2\"> Fr√≠o</label>\n      </div>\n    </section>\n\n    <!-- Paso 4: Reflexi√≥n guiada -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h2 class=\"text-xl font-semibold\">4) Reflexi√≥n guiada</h2>\n        <span class=\"text-xs text-gray-500\">Escribe sin juzgarte. Breve es mejor que perfecto.</span>\n      </div>\n      <div class=\"grid gap-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"whatHelped\">¬øQu√© ayud√≥ a dormir mejor?</label>\n          <textarea id=\"whatHelped\" rows=\"3\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Ej.: rutina constante, lectura ligera, habitaci√≥n fresca...\"></textarea>\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"whatHurt\">¬øQu√© lo dificult√≥?</label>\n          <textarea id=\"whatHurt\" rows=\"3\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Ej.: m√≥vil en la cama, preocupaciones, cafe√≠na tarde...\"></textarea>\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"gratitude\">Algo por lo que me siento agradecido/a hoy</label>\n          <textarea id=\"gratitude\" rows=\"2\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Peque√±as cosas cuentan.\"></textarea>\n        </div>\n      </div>\n    </section>\n\n    <!-- Paso 5: Acciones peque√±as -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h2 class=\"text-xl font-semibold\">5) Mi micro-h√°bito para hoy</h2>\n        <span class=\"text-xs text-gray-500\">Elige 1‚Äì3 acciones realistas</span>\n      </div>\n      <div id=\"habitChips\" class=\"flex flex-wrap gap-2 mb-3\"></div>\n      <div class=\"flex items-center gap-2\">\n        <input id=\"customHabit\" type=\"text\" placeholder=\"Escribe tu micro-h√°bito‚Ä¶\" class=\"flex-1 border rounded-xl px-3 py-2\" />\n        <button id=\"addHabit\" class=\"no-print rounded-xl border px-3 py-2 hover:bg-white\">A√±adir</button>\n      </div>\n    </section>\n\n    <!-- Acciones -->\n    <div class=\"no-print flex flex-wrap gap-3 mb-6\">\n      <button id=\"saveEntry\" class=\"rounded-xl border px-4 py-2 bg-gray-900 text-white\">Guardar entrada</button>\n      <button id=\"viewTrends\" class=\"rounded-xl border px-4 py-2 hover:bg-white\">Ver tendencias</button>\n      <button id=\"printBtn\" class=\"rounded-xl border px-4 py-2 hover:bg-white\">Imprimir</button>\n      <button id=\"exportBtn\" class=\"rounded-xl border px-4 py-2 hover:bg-white\">Exportar (.json)</button>\n      <button id=\"resetBtn\" class=\"rounded-xl border px-4 py-2 hover:bg-white\">Vaciar formulario</button>\n    </div>\n\n    <!-- Panel de insights -->\n    <section class=\"card p-5 md:p-6 mb-6 print:block\">\n      <h2 class=\"text-xl font-semibold mb-2\">Ideas r√°pidas a partir de tus datos</h2>\n      <p class=\"text-sm text-gray-600 mb-4\">Se generan al guardar. Buscan relaciones sencillas (no es diagn√≥stico m√©dico).</p>\n      <ul id=\"insights\" class=\"list-disc pl-6 text-sm space-y-2\"></ul>\n    </section>\n\n    <!-- Tendencias -->\n    <section class=\"card p-5 md:p-6 mb-12\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h2 class=\"text-xl font-semibold\">Tendencias (√∫ltimas 14 entradas)</h2>\n        <div class=\"text-xs text-gray-500\">Horas de sue√±o, energ√≠a y √°nimo</div>\n      </div>\n      <canvas id=\"trendChart\" height=\"120\"></canvas>\n    </section>\n\n    <footer class=\"text-center text-xs text-gray-500 mb-10\">\n      <p>Este recurso educativo es de prop√≥sito formativo. Si tienes dificultades persistentes de sue√±o, consulta con un profesional de la salud.</p>\n    </footer>\n  </div>\n\n  <script>\n    // Utilidades\n    const $ = (id) => document.getElementById(id);\n    const formatHours = (h) => (isFinite(h) ? h.toFixed(2) : \"‚Äî\");\n\n    // Chips de √°nimo y cuerpo\n    const MOODS = [\n      { id: 'feliz', label: 'Feliz', emoji: 'üòÑ' },\n      { id: 'tranquilo', label: 'Tranquilo/a', emoji: 'üôÇ' },\n      { id: 'neutro', label: 'Neutro', emoji: 'üòê' },\n      { id: 'irritable', label: 'Irritable', emoji: 'üò£' },\n      { id: 'triste', label: 'Triste', emoji: 'üòî' },\n      { id: 'ansioso', label: 'Ansioso/a', emoji: 'üò¨' },\n      { id: 'estresado', label: 'Estresado/a', emoji: 'üòµ‚Äçüí´' }\n    ];\n    const BODY = ['Ligera rigidez', 'Dolor de cabeza', 'Sequedad bucal', 'Pesadez', 'Ligereza', 'Tensi√≥n cervical', 'Fr√≠o', 'Calor'];\n\n    const DEFAULT_HABITS = [\n      'Cenar 3+ horas antes de dormir',\n      'Dejar pantallas 60 minutos antes',\n      'Rutina fija: acostarme a la misma hora',\n      'Leer 10 minutos en papel',\n      'Respirar 4-6 durante 3 min',\n      'Habitaci√≥n m√°s fresca',\n      'Tapones o ruido blanco',\n      'Luz baja 1 hora antes',\n      'Ejercicio suave por la tarde',\n      'Lista de pendientes fuera de la cama'\n    ];\n\n    function makeChip(text, group, on) {\n      const span = document.createElement('span');\n      span.className = 'chip';\n      span.textContent = text;\n      span.dataset.group = group;\n      span.addEventListener('click', () => {\n        span.classList.toggle('chip-active');\n        span.dataset.active = span.classList.contains('chip-active');\n      });\n      if (on) { span.classList.add('chip-active'); span.dataset.active = true; }\n      return span;\n    }\n\n    function renderChips() {\n      const moodWrap = $('moodChips');\n      moodWrap.innerHTML = '';\n      MOODS.forEach(m => {\n        const c = makeChip(`${m.emoji} ${m.label}`, 'mood');\n        c.addEventListener('click', () => {\n          [...moodWrap.children].forEach(ch => ch.classList.remove('chip-active'));\n          c.classList.add('chip-active');\n          $('moodHidden').value = m.id;\n        });\n        moodWrap.appendChild(c);\n      });\n\n      const bodyWrap = $('bodyChips');\n      bodyWrap.innerHTML = '';\n      BODY.forEach(b => bodyWrap.appendChild(makeChip(b, 'body')));\n\n      const habitWrap = $('habitChips');\n      habitWrap.innerHTML = '';\n      DEFAULT_HABITS.forEach(h => habitWrap.appendChild(makeChip(h, 'habit')));\n    }\n\n    // Calcular horas entre dos times (posible cruce de medianoche)\n    function calcHours(bed, wake) {\n      if (!bed || !wake) return NaN;\n      const [bh, bm] = bed.split(':').map(Number);\n      const [wh, wm] = wake.split(':').map(Number);\n      let start = bh + bm/60;\n      let end = wh + wm/60;\n      if (end <= start) end += 24; // cruz√≥ medianoche\n      return end - start;\n    }\n\n    function updateDerived() {\n      $('sleepQualityVal').textContent = $('sleepQuality').value;\n      $('energyVal').textContent = $('energy').value;\n      $('stressVal').textContent = $('stress').value;\n      const h = calcHours($('bedTime').value, $('wakeTime').value);\n      $('sleepHours').value = formatHours(h);\n    }\n\n    // Persistencia\n    function loadAll() {\n      try { return JSON.parse(localStorage.getItem('sleepJournalV1')) || []; } catch { return []; }\n    }\n    function saveAll(data) { localStorage.setItem('sleepJournalV1', JSON.stringify(data)); }\n    function saveEntry() {\n      const entry = collectEntry();\n      if (!entry.date) { alert('Elige una fecha.'); return; }\n      const all = loadAll();\n      const idx = all.findIndex(e => e.date === entry.date);\n      if (idx >= 0) all[idx] = entry; else all.push(entry);\n      saveAll(all);\n      $('saveStatus').textContent = 'Entrada guardada ‚úîÔ∏è';\n      setTimeout(()=> $('saveStatus').textContent = '', 2500);\n      renderInsights();\n      plotTrends();\n    }\n\n    function collectEntry() {\n      const body = [...$('bodyChips').children].filter(ch => ch.dataset.active === 'true').map(ch => ch.textContent);\n      const habits = [...$('habitChips').children].filter(ch => ch.dataset.active === 'true').map(ch => ch.textContent);\n      return {\n        date: $('entryDate').value,\n        bedTime: $('bedTime').value,\n        wakeTime: $('wakeTime').value,\n        awakenings: Number($('awakenings').value || 0),\n        sleepQuality: Number($('sleepQuality').value || 0),\n        sleepHours: Number($('sleepHours').value) || null,\n        dreams: $('hadDreams').checked,\n        mood: $('moodHidden').value || null,\n        energy: Number($('energy').value || 0),\n        body,\n        caffeine: Number($('caffeine').value || 0),\n        screens: Number($('screens').value || 0),\n        exercise: Number($('exercise').value || 0),\n        lateMeal: $('lateMeal').value || null,\n        alcohol: Number($('alcohol').value || 0),\n        stress: Number($('stress').value || 0),\n        env: {\n          noise: $('noise').checked,\n          light: $('light').checked,\n          tempHot: $('tempHot').checked,\n          tempCold: $('tempCold').checked,\n        },\n        whatHelped: $('whatHelped').value.trim(),\n        whatHurt: $('whatHurt').value.trim(),\n        gratitude: $('gratitude').value.trim(),\n        microHabits: habits\n      };\n    }\n\n    function fillForm(entry) {\n      if (!entry) return;\n      $('entryDate').value = entry.date || '';\n      $('bedTime').value = entry.bedTime || '';\n      $('wakeTime').value = entry.wakeTime || '';\n      $('awakenings').value = entry.awakenings ?? 0;\n      $('sleepQuality').value = entry.sleepQuality ?? 6;\n      $('hadDreams').checked = !!entry.dreams;\n      $('moodHidden').value = entry.mood || '';\n      $('energy').value = entry.energy ?? 6;\n      $('caffeine').value = entry.caffeine ?? 0;\n      $('screens').value = entry.screens ?? 0;\n      $('exercise').value = entry.exercise ?? 0;\n      $('lateMeal').value = entry.lateMeal || '';\n      $('alcohol').value = entry.alcohol ?? 0;\n      $('stress').value = entry.stress ?? 5;\n      $('noise').checked = entry.env?.noise || false;\n      $('light').checked = entry.env?.light || false;\n      $('tempHot').checked = entry.env?.tempHot || false;\n      $('tempCold').checked = entry.env?.tempCold || false;\n      $('whatHelped').value = entry.whatHelped || '';\n      $('whatHurt').value = entry.whatHurt || '';\n      $('gratitude').value = entry.gratitude || '';\n\n      // Reactivar chips\n      [...$('bodyChips').children].forEach(ch => { if (entry.body?.includes(ch.textContent)) ch.classList.add('chip-active'); });\n      [...$('habitChips').children].forEach(ch => { if (entry.microHabits?.includes(ch.textContent)) ch.classList.add('chip-active'); });\n\n      // Marcar mood chip\n      if (entry.mood) {\n        const moodWrap = $('moodChips');\n        [...moodWrap.children].forEach(ch => {\n          if (ch.textContent.includes(entry.mood.charAt(0).toUpperCase() + entry.mood.slice(1))) ch.classList.add('chip-active');\n        });\n      }\n\n      updateDerived();\n    }\n\n    // Exportar JSON\n    function exportJSON() {\n      const data = loadAll();\n      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'diario_sueno.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    }\n\n    // Tendencias con Chart.js\n    let chart;\n    function plotTrends() {\n      const all = loadAll().sort((a,b)=> a.date.localeCompare(b.date)).slice(-14);\n      const labels = all.map(e => e.date);\n      const hours = all.map(e => e.sleepHours ?? null);\n      const energy = all.map(e => e.energy ?? null);\n      const moodNum = all.map(e => moodToNum(e.mood));\n\n      const ctx = $('trendChart').getContext('2d');\n      if (chart) chart.destroy();\n      chart = new Chart(ctx, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [\n            { label: 'Horas de sue√±o', data: hours, tension: 0.3 },\n            { label: 'Energ√≠a (1‚Äì10)', data: energy, tension: 0.3 },\n            { label: '√Ånimo (1‚Äì5)', data: moodNum, tension: 0.3 },\n          ]\n        },\n        options: {\n          responsive: true,\n          plugins: { legend: { position: 'bottom' } },\n          scales: {\n            y: { beginAtZero: true }\n          }\n        }\n      });\n    }\n\n    function moodToNum(mood) {\n      switch(mood){\n        case 'feliz': return 5;\n        case 'tranquilo': return 4;\n        case 'neutro': return 3;\n        case 'irritable': return 2;\n        case 'triste': return 1.5;\n        case 'ansioso': return 2.2;\n        case 'estresado': return 2;\n        default: return null;\n      }\n    }\n\n    // Insights simples (correlaciones lineales aproximadas)\n    function correlation(x, y) {\n      const n = Math.min(x.length, y.length);\n      const xs = x.slice(0, n);\n      const ys = y.slice(0, n);\n      const mx = xs.reduce((a,b)=>a+b,0)/n;\n      const my = ys.reduce((a,b)=>a+b,0)/n;\n      let num=0, dx=0, dy=0;\n      for (let i=0;i<n;i++) { const vx = xs[i]-mx; const vy = ys[i]-my; num += vx*vy; dx += vx*vx; dy += vy*vy; }\n      const den = Math.sqrt(dx*dy) || 1;\n      return num/den;\n    }\n\n    function renderInsights() {\n      const list = $('insights');\n      list.innerHTML = '';\n      const all = loadAll();\n      if (all.length < 4) {\n        list.innerHTML = '<li>Necesitamos al menos 4 entradas para detectar patrones con m√°s sentido. ¬°Sigue registrando! üí™</li>';\n        return;\n      }\n      const last = all.slice(-14);\n      const hours = last.map(e => e.sleepHours ?? 0);\n      const energy = last.map(e => e.energy ?? 0);\n      const quality = last.map(e => e.sleepQuality ?? 0);\n      const screens = last.map(e => e.screens ?? 0);\n      const caffeine = last.map(e => e.caffeine ?? 0);\n      const stress = last.map(e => e.stress ?? 0);\n\n      const c1 = correlation(screens, quality);\n      const c2 = correlation(caffeine, hours);\n      const c3 = correlation(stress, energy);\n\n      function phr(r) {\n        if (r > 0.45) return 'fuerte';\n        if (r > 0.25) return 'moderada';\n        if (r > 0.1) return 'ligera';\n        if (r < -0.45) return 'fuerte (inversa)';\n        if (r < -0.25) return 'moderada (inversa)';\n        if (r < -0.1) return 'ligera (inversa)';\n        return 'd√©bil o nula';\n      }\n\n      const items = [];\n      items.push(`<li>Pantallas vs. calidad: relaci√≥n ${phr(c1)} (${c1.toFixed(2)}). Considera limitar pantallas 60 min antes.</li>`);\n      items.push(`<li>Cafe√≠na vs. horas de sue√±o: relaci√≥n ${phr(c2)} (${c2.toFixed(2)}). Prueba evitar cafe√≠na despu√©s de las 14:00.</li>`);\n      items.push(`<li>Estr√©s vs. energ√≠a al despertar: relaci√≥n ${phr(c3)} (${c3.toFixed(2)}). A√±ade 3 min de respiraci√≥n lenta antes de dormir.</li>`);\n\n      list.innerHTML = items.join('');\n    }\n\n    // Eventos UI\n    $('sleepQuality').addEventListener('input', updateDerived);\n    $('energy').addEventListener('input', updateDerived);\n    $('stress').addEventListener('input', updateDerived);\n    $('bedTime').addEventListener('change', updateDerived);\n    $('wakeTime').addEventListener('change', updateDerived);\n\n    $('saveEntry').addEventListener('click', saveEntry);\n    $('viewTrends').addEventListener('click', plotTrends);\n    $('printBtn').addEventListener('click', ()=> window.print());\n    $('exportBtn').addEventListener('click', exportJSON);\n    $('resetBtn').addEventListener('click', () => {\n      if (!confirm('¬øSeguro que quieres vaciar el formulario actual?')) return;\n      document.querySelectorAll('input, textarea').forEach(el => {\n        if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;\n        else if (el.type !== 'date') el.value = '';\n      });\n      renderChips();\n      updateDerived();\n    });\n\n    $('todayBtn').addEventListener('click', () => {\n      const d = new Date();\n      const iso = d.toISOString().slice(0,10);\n      $('entryDate').value = iso;\n      const all = loadAll();\n      const existing = all.find(e => e.date === iso);\n      renderChips();\n      if (existing) fillForm(existing); else updateDerived();\n    });\n\n    $('addHabit').addEventListener('click', () => {\n      const t = $('customHabit').value.trim();\n      if (!t) return;\n      $('habitChips').appendChild(makeChip(t, 'habit', true));\n      $('customHabit').value = '';\n    });\n\n    // Inicializaci√≥n\n    (function init(){\n      renderChips();\n      updateDerived();\n      // Fecha por defecto: hoy\n      $('todayBtn').click();\n      // Pintar tendencias iniciales\n      plotTrends();\n      renderInsights();\n    })();\n  </script>\n</body>\n</html>\n"
          ]
        }
      ]
    },
    {
      "id": "m2",
      "title": "Higiene del sue√±o: h√°bitos y rutinas saludables",
      "activities": [
        {
          "id": "m2a1",
          "title": "Concepto de higiene del sue√±o y factores influyentes",
          "description": "Recursos interactivo de aprendizaje reflexivo ",
          "type": "iframe",
          "content": [
            "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Higiene del sue√±o: concepto y factores influyentes</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <style>\n    @media print { .no-print{display:none!important;} }\n    .card{ @apply bg-white/80 backdrop-blur border rounded-2xl shadow-sm; }\n    .chip{ @apply inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm cursor-pointer transition; }\n    .chip-active{ @apply bg-gray-900 text-white border-gray-900; }\n    details[open] summary .chev{ transform: rotate(90deg); }\n  </style>\n</head>\n<body class=\"min-h-screen bg-gradient-to-br from-violet-50 via-sky-50 to-rose-50 text-gray-900\">\n  <main class=\"max-w-5xl mx-auto p-6 md:p-10\">\n\n    <header class=\"flex items-start justify-between gap-4 mb-6\">\n      <div>\n        <h1 class=\"text-3xl md:text-4xl font-bold tracking-tight\">Higiene del sue√±o y factores influyentes</h1>\n        <p class=\"text-gray-600 mt-2\">Recurso did√°ctico interactivo para comprender, autoevaluar y planificar mejoras sostenibles.</p>\n      </div>\n      <div class=\"no-print flex items-center gap-2\">\n        <button id=\"printBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Imprimir</button>\n        <button id=\"exportBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Exportar (.json)</button>\n        <button id=\"resetBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Restablecer</button>\n      </div>\n    </header>\n\n    <!-- Secci√≥n 1: Concepto -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-3\">Concepto de higiene del sue√±o</h2>\n      <p class=\"mb-3\">La <strong>higiene del sue√±o</strong> se refiere al conjunto de h√°bitos y pr√°cticas que favorecen un descanso nocturno reparador y de calidad. No se trata simplemente de dormir, sino de optimizar las condiciones para que el sue√±o sea eficiente y contribuya al bienestar f√≠sico y mental. Una buena higiene del sue√±o es crucial para la salud general, el rendimiento cognitivo, el estado de √°nimo y la resiliencia ante el estr√©s.</p>\n      <p>Para optimizarla, es fundamental adoptar un enfoque integral que considere y aborde los factores que siguen, creando un <em>ambiente</em> y unas <em>rutinas</em> que promuevan un descanso reparador y constante.</p>\n    </section>\n\n    <!-- Secci√≥n 2: Factores -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <div class=\"flex items-center justify-between mb-2\">\n        <h2 class=\"text-xl font-semibold\">Factores influyentes</h2>\n        <span class=\"text-xs text-gray-500\">Toca para desplegar</span>\n      </div>\n\n      <details class=\"mb-4\">\n        <summary class=\"flex items-center justify-between cursor-pointer select-none\">\n          <span class=\"font-medium\">1) Factores ambientales</span>\n          <span class=\"chev transition\">‚ñ∂</span>\n        </summary>\n        <div class=\"mt-3 grid md:grid-cols-2 gap-4\">\n          <div class=\"p-4 rounded-xl border bg-white\">\n            <h3 class=\"font-medium\">Iluminaci√≥n</h3>\n            <p class=\"text-sm text-gray-700\">La exposici√≥n a la luz, especialmente la luz azul de pantallas electr√≥nicas, suprime la producci√≥n de melatonina. Un dormitorio oscuro es esencial.</p>\n          </div>\n          <div class=\"p-4 rounded-xl border bg-white\">\n            <h3 class=\"font-medium\">Temperatura</h3>\n            <p class=\"text-sm text-gray-700\">Una habitaci√≥n fresca (‚âà18‚Äì22¬∞C) es √≥ptima. Temperaturas extremas dificultan conciliar y mantener el sue√±o.</p>\n          </div>\n          <div class=\"p-4 rounded-xl border bg-white\">\n            <h3 class=\"font-medium\">Ruido</h3>\n            <p class=\"text-sm text-gray-700\">El ruido excesivo o inesperado puede fragmentar el sue√±o e impedir alcanzar fases profundas. Un ambiente tranquilo es fundamental.</p>\n          </div>\n          <div class=\"p-4 rounded-xl border bg-white\">\n            <h3 class=\"font-medium\">Comodidad</h3>\n            <p class=\"text-sm text-gray-700\">Colch√≥n, almohadas y ropa de cama adecuados contribuyen significativamente a la calidad del descanso.</p>\n          </div>\n        </div>\n      </details>\n\n      <details class=\"mb-4\">\n        <summary class=\"flex items-center justify-between cursor-pointer select-none\">\n          <span class=\"font-medium\">2) Factores conductuales</span>\n          <span class=\"chev transition\">‚ñ∂</span>\n        </summary>\n        <ul class=\"list-disc pl-6 text-sm space-y-2 mt-3\">\n          <li><strong>Horarios irregulares:</strong> desajustan el ritmo circadiano y dificultan conciliar y despertar con energ√≠a.</li>\n          <li><strong>Estimulantes:</strong> cafe√≠na, nicotina y alcohol interfieren con el sue√±o; el alcohol induce somnolencia inicial pero fragmenta el sue√±o despu√©s.</li>\n          <li><strong>Actividad f√≠sica:</strong> es beneficiosa, pero intensa justo antes de acostarse puede ser contraproducente.</li>\n          <li><strong>Siestas prolongadas/tard√≠as:</strong> reducen el impulso de sue√±o nocturno.</li>\n          <li><strong>Rutina pre‚Äësue√±o:</strong> h√°bitos relajantes (leer, ba√±o caliente, meditar) preparan cuerpo y mente.</li>\n        </ul>\n      </details>\n\n      <details>\n        <summary class=\"flex items-center justify-between cursor-pointer select-none\">\n          <span class=\"font-medium\">3) Factores tecnol√≥gicos</span>\n          <span class=\"chev transition\">‚ñ∂</span>\n        </summary>\n        <ul class=\"list-disc pl-6 text-sm space-y-2 mt-3\">\n          <li><strong>Pantallas antes de dormir:</strong> la luz azul de m√≥viles, tabletas, ordenadores y TV reduce la melatonina y retrasa el inicio del sue√±o.</li>\n          <li><strong>Redes sociales y noticias:</strong> estimulaci√≥n mental/emocional que dificulta la relajaci√≥n necesaria.</li>\n          <li><strong>Alertas y notificaciones:</strong> interrupciones durante la noche pueden fragmentar el sue√±o, incluso sin despertar completo.</li>\n        </ul>\n      </details>\n    </section>\n\n    <!-- Secci√≥n 3: Autoevaluaci√≥n r√°pida -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-2\">Autoevaluaci√≥n r√°pida</h2>\n      <p class=\"text-sm text-gray-600 mb-4\">Marca lo que <em>s√≠</em> sueles hacer en una semana t√≠pica.</p>\n      <div id=\"selfCheck\" class=\"grid md:grid-cols-2 gap-3\">\n        <!-- Items generados por JS -->\n      </div>\n      <div class=\"mt-4 flex flex-wrap items-center gap-3\">\n        <button id=\"scoreBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Calcular puntuaci√≥n</button>\n        <div id=\"scoreOut\" class=\"text-sm text-gray-700\"></div>\n      </div>\n      <ul id=\"tipsOut\" class=\"mt-3 text-sm list-disc pl-6 space-y-1\"></ul>\n    </section>\n\n    <!-- Secci√≥n 4: Simulador de entorno -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-2\">Simulador de entorno</h2>\n      <p class=\"text-sm text-gray-600 mb-4\">Ajusta los deslizadores para ver recomendaciones inmediatas.</p>\n      <div class=\"grid md:grid-cols-3 gap-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"lightLvl\">Iluminaci√≥n nocturna</label>\n          <input id=\"lightLvl\" type=\"range\" min=\"0\" max=\"10\" value=\"4\" class=\"w-full\" />\n          <p class=\"text-xs text-gray-500\">0 = oscuridad total ¬∑ 10 = muy iluminado</p>\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"tempLvl\">Temperatura (¬∞C)</label>\n          <input id=\"tempLvl\" type=\"range\" min=\"14\" max=\"28\" value=\"21\" class=\"w-full\" />\n          <p class=\"text-xs text-gray-500\">Rango recomendado 18‚Äì22¬∞C</p>\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"noiseLvl\">Ruido ambiental</label>\n          <input id=\"noiseLvl\" type=\"range\" min=\"0\" max=\"10\" value=\"3\" class=\"w-full\" />\n          <p class=\"text-xs text-gray-500\">0 = silencio ¬∑ 10 = ruidoso</p>\n        </div>\n      </div>\n      <div id=\"envAdvice\" class=\"mt-4 text-sm text-gray-800\"></div>\n    </section>\n\n    <!-- Secci√≥n 5: Plan de mejora personal -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-2\">Plan de mejora (elige 3 micro‚Äëh√°bitos)</h2>\n      <div id=\"habitChips\" class=\"flex flex-wrap gap-2 mb-3\"></div>\n      <div class=\"grid md:grid-cols-2 gap-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"goal\">Objetivo de esta semana</label>\n          <input id=\"goal\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Ej.: Reducir pantallas antes de dormir\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"cue\">Se√±al/recordatorio</label>\n          <input id=\"cue\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Ej.: Alarma suave a las 21:30\" />\n        </div>\n      </div>\n      <button id=\"planBtn\" class=\"mt-4 rounded-xl border px-3 py-2 hover:bg-white\">Generar plan de 7 d√≠as</button>\n      <div id=\"planOut\" class=\"mt-4 text-sm\"></div>\n    </section>\n\n    <!-- Secci√≥n 6: Checklist pre‚Äësue√±o -->\n    <section class=\"card p-5 md:p-6 mb-10\">\n      <h2 class=\"text-xl font-semibold mb-2\">Checklist pre‚Äësue√±o</h2>\n      <div id=\"checklist\" class=\"grid md:grid-cols-2 gap-2\"></div>\n      <div class=\"no-print mt-3 flex flex-wrap gap-2\">\n        <button id=\"saveData\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Guardar</button>\n        <span id=\"status\" class=\"text-sm text-gray-500\"></span>\n      </div>\n    </section>\n\n    <footer class=\"text-center text-xs text-gray-500 mb-10\">\n      <p>Recurso educativo. Si los problemas persisten, consulta con un/a profesional de la salud.</p>\n    </footer>\n\n  </main>\n\n  <script>\n    const $ = (id)=>document.getElementById(id);\n\n    // --- Autoevaluaci√≥n ---\n    const CHECK_ITEMS = [\n      'Mantengo horarios regulares para acostarme y levantarme',\n      'Evito cafe√≠na al menos 6 horas antes de dormir',\n      'Reduzco pantallas 60 minutos antes de acostarme',\n      'Realizo actividad f√≠sica 3‚Äì5 d√≠as a la semana',\n      'Mantengo el dormitorio oscuro por la noche',\n      'Cuido la temperatura de la habitaci√≥n (18‚Äì22¬∞C)',\n      'Tengo una rutina relajante pre‚Äësue√±o',\n      'Silencio o modo avi√≥n por la noche'\n    ];\n\n    function renderSelfCheck(){\n      const box = $('selfCheck');\n      box.innerHTML = '';\n      CHECK_ITEMS.forEach((t,i)=>{\n        const id = 'sc'+i;\n        const el = document.createElement('label');\n        el.className = 'flex items-start gap-3 border rounded-xl p-3 bg-white';\n        el.innerHTML = `<input id=\"${id}\" type=\"checkbox\" class=\"mt-1\"> <span class=\"text-sm\">${t}</span>`;\n        box.appendChild(el);\n      });\n    }\n\n    function scoreSelfCheck(){\n      const vals = CHECK_ITEMS.map((_,i)=> $('sc'+i).checked ? 1:0);\n      const sum = vals.reduce((a,b)=>a+b,0);\n      $('scoreOut').textContent = `Puntuaci√≥n: ${sum}/8`;\n      const tips = [];\n      if(!$('sc2').checked) tips.push('Prueba un ‚Äútoque de queda digital‚Äù 60‚Äì90 min antes de dormir.');\n      if(!$('sc1').checked) tips.push('Mueve la √∫ltima cafe√≠na a antes de las 14:00‚Äì15:00.');\n      if(!$('sc6').checked) tips.push('Dise√±a una rutina pre‚Äësue√±o de 10‚Äì15 min (respiraci√≥n, lectura ligera).');\n      if(!$('sc4').checked) tips.push('Asegura oscuridad: cortinas opacas o antifaz.');\n      if(!$('sc3').checked) tips.push('Evita ejercicio intenso 2‚Äì3 h antes de la cama; mejor por la tarde.');\n      if(!$('sc7').checked) tips.push('Activa ‚ÄúNo molestar‚Äù o modo avi√≥n nocturno.');\n      $('tipsOut').innerHTML = tips.map(t=>`<li>${t}</li>`).join('');\n    }\n\n    // --- Simulador de entorno ---\n    function updateEnvAdvice(){\n      const light = +$('lightLvl').value;\n      const temp = +$('tempLvl').value;\n      const noise = +$('noiseLvl').value;\n      const msgs = [];\n      if(light>3) msgs.push('Baja iluminaci√≥n: usa luz c√°lida tenue y evita pantallas.');\n      if(temp<18) msgs.push('La temperatura est√° fr√≠a: considera otra manta o pijama m√°s abrigado.');\n      if(temp>22) msgs.push('La temperatura est√° alta: ventila o usa ropa de cama m√°s ligera.');\n      if(noise>2) msgs.push('Aten√∫a ruido: tapones, ruido blanco o cerrar ventanas.');\n      if(msgs.length===0) msgs.push('¬°Buen entorno! Mant√©n la consistencia.');\n      $('envAdvice').innerHTML = msgs.map(m=>`<div class=\"text-sm\">‚Ä¢ ${m}</div>`).join('');\n    }\n\n    // --- Plan de mejora ---\n    const HABITS = [\n      'Dejar pantallas 60‚Äì90 min antes',\n      'Acostarme y levantarme a la misma hora',\n      'Cortar cafe√≠na desde las 14:00',\n      'Rutina de respiraci√≥n 4‚Äë6 (3 min)',\n      'Lectura en papel 10 min',\n      'Habitaci√≥n a 19‚Äì21¬∞C',\n      'Modo ‚ÄúNo molestar‚Äù nocturno',\n      'Lista de pendientes fuera de la cama',\n      'Cenar 3 horas antes',\n      'Ejercicio suave por la tarde'\n    ];\n\n    function chip(text){\n      const s = document.createElement('span');\n      s.className = 'chip';\n      s.textContent = text;\n      s.addEventListener('click',()=>{\n        s.classList.toggle('chip-active');\n      });\n      return s;\n    }\n\n    function renderHabitChips(){\n      const wrap = $('habitChips');\n      wrap.innerHTML = '';\n      HABITS.forEach(h=> wrap.appendChild(chip(h)) );\n    }\n\n    function generatePlan(){\n      const chosen = [...$('habitChips').children].filter(c=>c.classList.contains('chip-active')).map(c=>c.textContent).slice(0,3);\n      const goal = $('goal').value.trim() || 'Dormir mejor esta semana';\n      const cue = $('cue').value.trim() || 'Alarma suave a las 21:30';\n      if(chosen.length===0){ $('planOut').innerHTML = '<p class=\"text-sm text-red-600\">Selecciona al menos 1 h√°bito.</p>'; return; }\n      const days = ['Lun','Mar','Mi√©','Jue','Vie','S√°b','Dom'];\n      const rows = days.map((d,i)=>`<tr><td class=\"px-3 py-2 border\">${d}</td><td class=\"px-3 py-2 border\">${chosen[i%chosen.length]}</td><td class=\"px-3 py-2 border\">${cue}</td></tr>`).join('');\n      $('planOut').innerHTML = `\n        <div class=\"border rounded-xl overflow-hidden\">\n          <div class=\"px-4 py-2 bg-gray-50 border-b text-sm\"><strong>Objetivo:</strong> ${goal}</div>\n          <table class=\"w-full text-sm\">\n            <thead class=\"bg-gray-50\"><tr><th class=\"px-3 py-2 text-left border\">D√≠a</th><th class=\"px-3 py-2 text-left border\">Micro‚Äëh√°bito</th><th class=\"px-3 py-2 text-left border\">Se√±al</th></tr></thead>\n            <tbody>${rows}</tbody>\n          </table>\n        </div>`;\n    }\n\n    // --- Checklist ---\n    const CHECKLIST_ITEMS = [\n      'Oscurecer habitaci√≥n / antifaz',\n      'Silenciar notificaciones',\n      'Guardar m√≥vil fuera del alcance',\n      'Preparar ropa de cama c√≥moda',\n      'Ventilar 5‚Äì10 minutos',\n      'Rutina de relajaci√≥n 10 min',\n      '√öltima comida 3 h antes',\n      'Hidrataci√≥n ligera',\n      'Ajustar temperatura',\n      'Respiraci√≥n lenta antes de dormir'\n    ];\n\n    function renderChecklist(){\n      const box = $('checklist');\n      box.innerHTML = '';\n      CHECKLIST_ITEMS.forEach((t,i)=>{\n        const id = 'cl'+i;\n        const el = document.createElement('label');\n        el.className = 'flex items-start gap-3 border rounded-xl p-3 bg-white';\n        el.innerHTML = `<input id=\"${id}\" type=\"checkbox\" class=\"mt-1\"> <span class=\"text-sm\">${t}</span>`;\n        box.appendChild(el);\n      });\n    }\n\n    // --- Persistencia ---\n    function load(){ try{return JSON.parse(localStorage.getItem('sleepHygieneResourceV1'))||{};}catch{return{};} }\n    function save(obj){ localStorage.setItem('sleepHygieneResourceV1', JSON.stringify(obj)); }\n\n    function exportJSON(){\n      const data = load();\n      const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url; a.download = 'higiene_sueno.json'; a.click();\n      URL.revokeObjectURL(url);\n    }\n\n    function handleSave(){\n      const state = {\n        selfcheck: CHECK_ITEMS.map((_,i)=> $('sc'+i)?.checked || false),\n        sliders: { light:+$('lightLvl').value, temp:+$('tempLvl').value, noise:+$('noiseLvl').value },\n        plan: { goal: $('goal').value, cue: $('cue').value, habits: [...$('habitChips').children].filter(c=>c.classList.contains('chip-active')).map(c=>c.textContent) },\n        checklist: CHECKLIST_ITEMS.map((_,i)=> $('cl'+i)?.checked || false)\n      };\n      save(state);\n      $('status').textContent = 'Guardado ‚úîÔ∏è';\n      setTimeout(()=> $('status').textContent = '', 2000);\n    }\n\n    function restore(){\n      const state = load();\n      // selfcheck\n      if(state.selfcheck){ state.selfcheck.forEach((v,i)=>{ const el=$('sc'+i); if(el) el.checked = !!v; }); }\n      // sliders\n      if(state.sliders){ $('lightLvl').value = state.sliders.light ?? 4; $('tempLvl').value = state.sliders.temp ?? 21; $('noiseLvl').value = state.sliders.noise ?? 3; }\n      // plan\n      if(state.plan){ $('goal').value = state.plan.goal || ''; $('cue').value = state.plan.cue || ''; state.plan.habits?.forEach(h=>{ [...$('habitChips').children].forEach(ch=>{ if(ch.textContent===h) ch.classList.add('chip-active'); }); }); }\n      // checklist\n      if(state.checklist){ state.checklist.forEach((v,i)=>{ const el=$('cl'+i); if(el) el.checked = !!v; }); }\n      updateEnvAdvice();\n    }\n\n    function resetAll(){\n      if(!confirm('¬øRestablecer el recurso a su estado inicial?')) return;\n      localStorage.removeItem('sleepHygieneResourceV1');\n      renderSelfCheck();\n      renderHabitChips();\n      renderChecklist();\n      $('goal').value = '';\n      $('cue').value = '';\n      $('lightLvl').value = 4; $('tempLvl').value = 21; $('noiseLvl').value = 3;\n      updateEnvAdvice();\n      $('scoreOut').textContent = '';\n      $('tipsOut').innerHTML = '';\n      $('planOut').innerHTML = '';\n      $('status').textContent = '';\n    }\n\n    // --- Eventos ---\n    $('scoreBtn').addEventListener('click', scoreSelfCheck);\n    $('lightLvl').addEventListener('input', updateEnvAdvice);\n    $('tempLvl').addEventListener('input', updateEnvAdvice);\n    $('noiseLvl').addEventListener('input', updateEnvAdvice);\n    $('planBtn').addEventListener('click', generatePlan);\n    $('saveData').addEventListener('click', handleSave);\n    $('exportBtn').addEventListener('click', exportJSON);\n    $('printBtn').addEventListener('click', ()=>window.print());\n    $('resetBtn').addEventListener('click', resetAll);\n\n    // --- Inicio ---\n    (function init(){\n      renderSelfCheck();\n      renderHabitChips();\n      renderChecklist();\n      restore();\n      updateEnvAdvice();\n    })();\n  </script>\n</body>\n</html>\n"
          ]
        },
        {
          "id": "m2a2",
          "title": "Consejos Pr√°cticos para Dormir Mejor ",
          "description": "Voltear la tarjeta toc√°ndola para ver el consejo detallado.\n\nNavegar entre los diferentes tips usando las flechas de \"Anterior\" y \"Siguiente\".\n\nVer el n√∫mero actual de tarjeta para saber cu√°nto te falta por repasar.\n\n¬°Espero que estos consejos te ayuden a mejorar tu descanso! ",
          "type": "iframe",
          "content": [
            "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Flashcards de Higiene del Sue√±o</title>\n    <!-- Carga de Tailwind CSS -->\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap\" rel=\"stylesheet\">\n    <style>\n        /* Configuraci√≥n de fuente y cuerpo */\n        body {\n            font-family: 'Inter', sans-serif;\n            background-color: #eef2ff; /* P√∫rpura muy claro */\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 100vh;\n            padding: 1rem;\n        }\n\n        /* Estilos para el efecto de volteo 3D de la tarjeta */\n        .flashcard-container {\n            perspective: 1000px; /* Necesario para el efecto 3D */\n            height: 450px; /* Altura fija para consistencia en desktop */\n            width: 100%;\n            max-width: 450px;\n        }\n        .flashcard-inner {\n            position: relative;\n            width: 100%;\n            height: 100%;\n            text-align: center;\n            transition: transform 0.8s;\n            transform-style: preserve-3d;\n            cursor: pointer;\n        }\n        .is-flipped {\n            transform: rotateY(180deg);\n        }\n        \n        /* Estilos comunes para el frente y el reverso */\n        .flashcard-front, .flashcard-back {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n            -webkit-backface-visibility: hidden;\n            backface-visibility: hidden;\n            border-radius: 1.5rem; /* rounded-3xl */\n            padding: 2rem;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n            transition: box-shadow 0.3s;\n        }\n        .flashcard-front:hover, .flashcard-back:hover {\n            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        }\n\n        /* Estilo espec√≠fico para el frente */\n        .flashcard-front {\n            background-color: #ffffff;\n            color: #1f2937; /* Gris oscuro */\n            border: 4px solid #818cf8; /* √çndigo 300 */\n        }\n\n        /* Estilo espec√≠fico para el reverso */\n        .flashcard-back {\n            background-color: #4f46e5; /* √çndigo 600 */\n            color: white;\n            transform: rotateY(180deg);\n        }\n\n        /* Ajustes de altura para m√≥viles */\n        @media (max-width: 640px) {\n            .flashcard-container {\n                height: 350px;\n            }\n        }\n    </style>\n</head>\n<body class=\"selection:bg-indigo-300 selection:text-indigo-900\">\n\n    <div class=\"flex flex-col items-center w-full max-w-xl\">\n\n        <h1 class=\"text-3xl font-extrabold text-gray-800 mb-6 text-center md:text-4xl\">\n            üí§ Consejos Pr√°cticos para Dormir Mejor\n        </h1>\n        <p class=\"text-gray-600 mb-8 text-center max-w-md\">\n            Voltea la tarjeta para descubrir el tip. ¬°Aseg√∫rate de repasar todos los h√°bitos!\n        </p>\n\n        <!-- Contenedor principal de la tarjeta -->\n        <div id=\"flashcard\" class=\"flashcard-container\">\n            <div class=\"flashcard-inner\" id=\"card-inner\" onclick=\"flipCard()\">\n                <!-- Frente de la tarjeta -->\n                <div class=\"flashcard-front\">\n                    <span id=\"card-status-front\" class=\"text-sm font-semibold text-indigo-500 mb-3\">CONSEJO #1 / 6</span>\n                    <h2 id=\"card-prompt\" class=\"text-3xl font-extrabold text-indigo-700 leading-snug\">\n                        ¬øQu√© ayuda a tu mente a prepararse para descansar?\n                    </h2>\n                    <p class=\"absolute bottom-4 text-sm italic text-gray-500 transition duration-300 hover:text-indigo-600\">\n                        Toca la tarjeta para revelar el consejo pr√°ctico.\n                    </p>\n                </div>\n\n                <!-- Reverso de la tarjeta -->\n                <div class=\"flashcard-back\">\n                    <h3 class=\"text-2xl font-bold mb-4\">El H√°bito Clave:</h3>\n                    <p id=\"card-tip\" class=\"text-white text-lg leading-relaxed\">\n                        Crea una **rutina relajante** antes de dormir (ej. leer, ba√±o caliente, estiramientos suaves). Esto le indica a tu cerebro que es hora de bajar el ritmo.\n                    </p>\n                    <span class=\"absolute bottom-4 text-sm italic text-indigo-200\">\n                        Toca para volver a ver la pregunta.\n                    </span>\n                </div>\n            </div>\n        </div>\n\n        <!-- Controles de navegaci√≥n -->\n        <div class=\"flex justify-between w-full max-w-sm mt-8 space-x-4\">\n            <button id=\"prev-btn\" onclick=\"navigateCard(-1)\"\n                class=\"flex items-center justify-center p-3 bg-white text-indigo-600 font-bold rounded-full shadow-lg hover:bg-indigo-50 transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed border border-indigo-200\">\n                <!-- SVG de flecha izquierda (lucide-react: ChevronLeft) -->\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-6 h-6\">\n                    <path d=\"m15 18-6-6 6-6\"/>\n                </svg>\n            </button>\n            \n            <button id=\"next-btn\" onclick=\"navigateCard(1)\"\n                class=\"flex items-center justify-center p-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed\">\n                <!-- SVG de flecha derecha (lucide-react: ChevronRight) -->\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"w-6 h-6\">\n                    <path d=\"m9 18 6-6-6-6\"/>\n                </svg>\n            </button>\n        </div>\n        \n        <!-- Indicador de estado de las tarjetas -->\n        <p id=\"card-index-info\" class=\"text-sm text-gray-500 mt-4\">\n            Tarjeta 1 de 6\n        </p>\n\n    </div>\n\n    <script>\n        // Array de objetos con los consejos de sue√±o (pregunta y tip detallado)\n        const sleepTips = [\n            { prompt: \"¬øQu√© ayuda a tu mente a prepararse para descansar?\", tip: \"Crea una **rutina relajante** antes de dormir (ej. leer, ba√±o caliente, estiramientos suaves). Esto le indica a tu cerebro que es hora de bajar el ritmo.\" },\n            { prompt: \"¬øQu√© debo evitar al menos una hora antes de dormir?\", tip: \"Evita la exposici√≥n a **pantallas** (m√≥viles, tabletas, TV). La luz azul suprime la melatonina, la hormona que regula el sue√±o.\" },\n            { prompt: \"¬øCu√°l es la clave de la consistencia en el sue√±o?\", tip: \"Mant√©n **horarios de sue√±o consistentes**, incluso los fines de semana. Esto regula tu reloj biol√≥gico (ritmo circadiano).\" },\n            { prompt: \"¬øC√≥mo debe ser el ambiente ideal para dormir?\", tip: \"Aseg√∫rate de que tu habitaci√≥n est√© **oscura, fresca** (entre 18 y 20¬∞C) y **silenciosa**. Esto optimiza la calidad del sue√±o profundo.\" },\n            { prompt: \"¬øQu√© sustancias debo limitar por la tarde?\", tip: \"Limita la ingesta de **cafe√≠na** (caf√©, t√©, refrescos) y **alcohol** varias horas antes de acostarte, ya que fragmentan el sue√±o.\" },\n            { prompt: \"¬øCu√°l es la regla para el ejercicio y la hora de dormir?\", tip: \"**Realiza ejercicio regularmente**, pero evita el ejercicio intenso 3 horas antes de acostarte, ya que el aumento de la temperatura corporal dificulta conciliar el sue√±o.\" }\n        ];\n\n        let currentCardIndex = 0;\n        let isFlipped = false;\n\n        const cardInner = document.getElementById('card-inner');\n        const cardPrompt = document.getElementById('card-prompt');\n        const cardTip = document.getElementById('card-tip');\n        const cardStatusFront = document.getElementById('card-status-front');\n        const cardIndexInfo = document.getElementById('card-index-info');\n        const prevBtn = document.getElementById('prev-btn');\n        const nextBtn = document.getElementById('next-btn');\n\n        /**\n         * Carga los contenidos de la tarjeta actual en el DOM.\n         */\n        function loadCardContent() {\n            const tip = sleepTips[currentCardIndex];\n            \n            // Reemplaza el contenido con soporte para formato (bold)\n            cardPrompt.innerHTML = tip.prompt;\n            cardTip.innerHTML = tip.tip;\n\n            // Actualiza los n√∫meros de estado\n            const totalCards = sleepTips.length;\n            cardStatusFront.textContent = `CONSEJO #${currentCardIndex + 1} / ${totalCards}`;\n            cardIndexInfo.textContent = `Tarjeta ${currentCardIndex + 1} de ${totalCards}`;\n\n            // Deshabilita/Habilita botones de navegaci√≥n\n            prevBtn.disabled = currentCardIndex === 0;\n            nextBtn.disabled = currentCardIndex === totalCards - 1;\n\n            // Asegura que la tarjeta se muestre en el frente al cambiar de contenido\n            if (isFlipped) {\n                cardInner.classList.remove('is-flipped');\n                isFlipped = false;\n            }\n        }\n\n        /**\n         * Voltea la tarjeta al hacer click.\n         */\n        function flipCard() {\n            isFlipped = !isFlipped;\n            if (isFlipped) {\n                cardInner.classList.add('is-flipped');\n            } else {\n                cardInner.classList.remove('is-flipped');\n            }\n        }\n\n        /**\n         * Navega a la siguiente o anterior tarjeta.\n         * @param {number} direction - 1 para siguiente, -1 para anterior.\n         */\n        function navigateCard(direction) {\n            const newIndex = currentCardIndex + direction;\n            if (newIndex >= 0 && newIndex < sleepTips.length) {\n                currentCardIndex = newIndex;\n                loadCardContent();\n            }\n        }\n\n        // Inicializar la primera tarjeta al cargar\n        window.onload = loadCardContent;\n\n    </script>\n</body>\n</html>"
          ]
        },
        {
          "id": "m2a3",
          "title": "Como Dise√±ar una rutina nocturna personalizada. ",
          "description": "Escucha el audio y reflexiona sobre como puedes aplicarlo en tu rutina ",
          "type": "audio",
          "audioSrc": assetPath('audios/higiene-sueno_mod2.mp3'),
         
        }
      ]
    },
    {
      "id": "m3",
      "title": "Sue√±o y emociones: un c√≠rculo bidireccional",
      "activities": [
        {
          "id": "m3a1",
          "title": "Relaci√≥n entre trastornos del sue√±o y estados emocionales como ansiedad, estr√©s y depresi√≥n.",
          "description": "Lectura breve para reflexionar ",
          "type": "text",
          "content": [
            " La relaci√≥n entre los trastornos del sue√±o y los estados emocionales, como la ansiedad, el estr√©s y la depresi√≥n, es un campo de estudio en constante evoluci√≥n y de gran relevancia para la salud mental. Se ha observado que existe una interacci√≥n bidireccional compleja entre estos elementos: por un lado, los trastornos del sue√±o pueden ser un s√≠ntoma o un factor que exacerba condiciones emocionales preexistentes; por otro, la ansiedad, el estr√©s y la depresi√≥n pueden deteriorar significativamente la calidad y la cantidad del sue√±o.\nLa privaci√≥n cr√≥nica del sue√±o o la presencia de parasomnias y otros trastornos del sue√±o pueden alterar los circuitos neuronales implicados en la regulaci√≥n del estado de √°nimo, la memoria y la toma de decisiones, contribuyendo al desarrollo o al empeoramiento de la ansiedad y la depresi√≥n. A su vez, los altos niveles de estr√©s y la rumiaci√≥n asociada a la ansiedad y la depresi√≥n pueden dificultar el inicio y el mantenimiento del sue√±o, creando un ciclo vicioso que perpet√∫a ambos problemas. Comprender esta interconexi√≥n es fundamental para desarrollar estrategias de intervenci√≥n efectivas que aborden tanto los problemas del sue√±o como los desaf√≠os emocionales de manera integral.\n"
          ]
        },
        {
          "id": "m3a2",
          "title": "Como Duermo - Como me Siento ",
          "description": "Realiza este quiz y descubre como tu relaci√≥n con el sue√±o esta afectando tu bienestar emocional ",
          "type": "quiz",
          "questions": [
            {
              "question": "¬øC√≥mo describir√≠as tu proceso habitual para conciliar el sue√±o por la noche?",
              "options": [
                { "text": "Me duermo r√°pidamente (‚â§20 min).", "feedback": "¬°Excelente! Indica buena higiene del sue√±o y ritmo estable." },
                { "text": "Tardo un poco; la mente est√° activa.", "feedback": "Com√∫n; prueba una rutina de relajaci√≥n previa." },
                { "text": "Tardo mucho (‚â•30 min) y me frustro.", "feedback": "Se√±al de tensi√≥n/h√°bitos sub√≥ptimos. Ajusta tu ritual nocturno." }
              ]
            },
            {
              "question": "Si te despiertas en la noche, ¬øqu√© sucede?",
              "options": [
                { "text": "Vuelvo a dormir sin dificultad.", "feedback": "Buena continuidad de sue√±o." },
                { "text": "Me cuesta un poco, pero lo consigo.", "feedback": "Evita pantallas y mirar el reloj." },
                { "text": "Me cuesta mucho volver a dormir.", "feedback": "Valora entorno, h√°bitos y manejo de estr√©s." }
              ]
            },
            {
              "question": "¬øC√≥mo te sientes al despertar?",
              "options": [
                { "text": "Con energ√≠a y claridad.", "feedback": "Objetivo del sue√±o reparador cumplido." },
                { "text": "Intermedio; a veces bien, a veces cansado/a.", "feedback": "Ajustes en cantidad/calidad pueden ayudar." },
                { "text": "Cansado/a como si no hubiera dormido.", "feedback": "Revisa higiene del sue√±o y posibles causas." }
              ]
            }
          ]
        },
        {
          "id": "m3a3",
          "title": "Quiz",
          "description": "Realiza este quiz y descubre c√≥mo tu relaci√≥n con el sue√±o est√° afectando tu bienestar emocional.",
          "type": "quiz",
          "questions": [
            {
              "question": "¬øC√≥mo describir√≠as tu proceso habitual para conciliar el sue√±o por la noche?",
              "options": [
                { "text": "Me duermo r√°pidamente, generalmente en menos de 15-20 minutos, sin mayores dificultades.", "feedback": "¬°Excelente! Esto sugiere una buena higiene del sue√±o y una relaci√≥n saludable con el descanso, donde tu cuerpo y mente est√°n listos para relajarse al final del d√≠a. Es una se√±al de que tu ciclo circadiano est√° bien ajustado." },
                { "text": "Me toma un tiempo, a veces doy vueltas en la cama o mi mente est√° muy activa con pensamientos.", "feedback": "Esta es una experiencia com√∫n. Indica que podr√≠as beneficiarte de establecer una rutina de relajaci√≥n antes de acostarte o gestionar mejor el estr√©s. Aunque no es lo ideal, es un punto de partida para mejorar tus h√°bitos de sue√±o." },
                { "text": "Suelo tardar mucho en dormirme, a menudo m√°s de 30 minutos, y me frustro al no lograrlo.", "feedback": "Si te identificas con esto, tu relaci√≥n con el sue√±o puede estar tensa. La dificultad para conciliar el sue√±o puede ser un signo de ansiedad, estr√©s o h√°bitos de sue√±o inadecuados. Es importante explorar estrategias para relajar tu mente y cuerpo antes de dormir." }
              ]
            },
            {
              "question": "¬øQu√© ocurre si te despiertas en medio de la noche?",
              "options": [
                { "text": "Generalmente, vuelvo a dormirme sin dificultad en poco tiempo.", "feedback": "¬°Muy bien! Un despertar ocasional es normal, pero volver a dormir r√°pidamente demuestra una buena continuidad del sue√±o y resiliencia. Tu cuerpo sabe c√≥mo retomar el descanso, lo que es clave para un sue√±o reparador." },
                { "text": "A veces me cuesta un poco retomar el sue√±o, pero casi siempre lo consigo.", "feedback": "Esto es bastante com√∫n. Sugiere que, aunque tu sue√±o puede ser algo fragmentado, tu capacidad para volver a dormir es s√≥lida. Considera evitar pantallas o mirar el reloj si te despiertas para facilitar el retorno al sue√±o." },
                { "text": "Me cuesta mucho volver a dormirme, a menudo paso horas despierto/a y eso me genera preocupaci√≥n.", "feedback": "Esta es una se√±al de que tu sue√±o es muy fragmentado y tu relaci√≥n con el sue√±o puede ser fuente de estr√©s. Despertarse y no poder volver a dormir puede afectar seriamente la calidad de tu descanso. Podr√≠a ser √∫til revisar tu entorno de sue√±o y tus h√°bitos." }
              ]
            },
            {
              "question": "¬øC√≥mo te sientes al despertar por la ma√±ana?",
              "options": [
                { "text": "Me siento descansado/a y con energ√≠a, listo/a para empezar el d√≠a.", "feedback": "¬°Felicidades! Despertar as√≠ es el objetivo principal del sue√±o. Indica que est√°s obteniendo un sue√±o de buena calidad y cantidad, lo que te permite funcionar de manera √≥ptima durante el d√≠a. Tu relaci√≥n con el sue√±o es saludable." },
                { "text": "Me siento un poco cansado/a o aturdido/a al principio, pero mejoro despu√©s de un rato.", "feedback": "Es una experiencia frecuente. Aunque te adaptas, podr√≠a ser una se√±al de que no est√°s alcanzando todas las etapas profundas del sue√±o o que necesitas un poco m√°s de cantidad. Peque√±os ajustes en tu rutina podr√≠an marcar una gran diferencia." },
                { "text": "Suelo despertarme agotado/a, como si no hubiera dormido nada, y me cuesta mucho levantarme de la cama.", "feedback": "Este sentimiento de agotamiento al despertar es un indicativo claro de que tu sue√±o no es reparador. Puede ser debido a falta de cantidad, mala calidad, o incluso un trastorno del sue√±o subyacente. Tu relaci√≥n con el sue√±o parece ser una lucha, y ser√≠a bueno investigar las causas." }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "m4",
      "title": "Estrategias para mejorar el descanso y la regulaci√≥n emocional",
      "activities": [
        {
          "id": "m4a1",
          "title": "T√©cnicas de relajaci√≥n, mindfulness, respiraci√≥n y desconexi√≥n digital.",
          "description": "Lectura para reflexionar ",
          "type": "text",
          "content": [
            "Las t√©cnicas de relajaci√≥n, el mindfulness, la respiraci√≥n consciente y la desconexi√≥n digital son herramientas esenciales para gestionar el estr√©s y mejorar el bienestar general en la vida moderna. La relajaci√≥n abarca una variedad de m√©todos como la relajaci√≥n muscular progresiva, que consiste en tensar y relajar diferentes grupos musculares, o la relajaci√≥n aut√≥gena, basada en sugerencias de pesadez y calor en el cuerpo, que buscan disminuir la tensi√≥n f√≠sica y mental acumulada.\nEl mindfulness, o atenci√≥n plena, nos invita a observar el momento presente sin juicio, cultivando una mayor conciencia de nuestros pensamientos, emociones y sensaciones corporales. Esta pr√°ctica nos ayuda a desvincularnos de patrones de pensamiento negativos y a responder a las situaciones con mayor calma y claridad, fomentando as√≠ una perspectiva m√°s equilibrada de la vida.\nLas t√©cnicas de respiraci√≥n, por su parte, nos ense√±an a utilizar el aliento como ancla para calmar el sistema nervioso, reduciendo la ansiedad y promoviendo un estado de serenidad. Ejercicios como la respiraci√≥n diafragm√°tica o la respiraci√≥n 4-7-8 son ejemplos poderosos que pueden ser practicados en cualquier momento y lugar para restablecer la tranquilidad.\nFinalmente, la desconexi√≥n digital se ha vuelto crucial en una sociedad hiperconectada. Implica establecer l√≠mites conscientes con la tecnolog√≠a, como apagar notificaciones, designar tiempos sin pantallas o realizar \"detox\" digitales peri√≥dicos. Esto nos permite recuperar tiempo y espacio para actividades m√°s significativas, fomentar las relaciones interpersonales y disfrutar de un descanso mental genuino, lejos de la constante estimulaci√≥n digital.\nIntegrar estas pr√°cticas en la rutina diaria puede llevar a una significativa mejora en la calidad de vida, potenciando la resiliencia ante los desaf√≠os, el equilibrio emocional y una mayor sensaci√≥n de control sobre nuestro propio bienestar. Al hacer de estas herramientas una parte constante de nuestra vida, cultivamos un camino hacia una existencia m√°s plena y consciente.\n"
          ]
        },
        {
          "id": "m4a2",
          "title": "Audio de meditaci√≥n guiada para antes de dormir.",
          "description": "escucha y sigue las indicaciones del audio ",
          "type": "audio",
          "audioSrc": assetPath('audios/higiene-sueno_mod4.mp3')
        }
      ]
    },
    {
      "id": "m5",
      "title": "Construyendo mi propio plan de bienestar nocturno",
      "activities": [
        {
          "id": "m5a1",
          "title": "C√≥mo integrar h√°bitos, emociones y autoconocimiento en un plan de sue√±o sostenible.",
          "description": "recursos interactivo de reflexi√≥n ",
          "type": "iframe",
          "content": [
            "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Plan de Sue√±o Sostenible ¬∑ H√°bitos ¬∑ Emociones ¬∑ Autoconocimiento</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n  <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n  <style>\n    @media print { .no-print{display:none!important;} }\n    .card{ @apply bg-white/80 backdrop-blur border rounded-2xl shadow-sm; }\n    .chip{ @apply inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm cursor-pointer transition; }\n    .chip-active{ @apply bg-gray-900 text-white border-gray-900; }\n    .pill{ @apply px-3 py-1 rounded-full text-xs border; }\n    .pill-good{ @apply bg-green-50 border-green-200 text-green-700; }\n    .pill-warn{ @apply bg-yellow-50 border-yellow-200 text-yellow-700; }\n  </style>\n</head>\n<body class=\"min-h-screen bg-gradient-to-br from-sky-50 via-indigo-50 to-rose-50 text-gray-900\">\n  <main class=\"max-w-6xl mx-auto p-6 md:p-10\">\n    <header class=\"flex flex-wrap items-start justify-between gap-4 mb-6\">\n      <div>\n        <h1 class=\"text-3xl md:text-4xl font-bold tracking-tight\">C√≥mo integrar h√°bitos, emociones y autoconocimiento en un plan de sue√±o sostenible</h1>\n        <p class=\"text-gray-600 mt-2\">Recurso did√°ctico e interactivo para convertir conocimiento en acci√≥n sostenible.</p>\n      </div>\n      <div class=\"no-print flex items-center gap-2\">\n        <button id=\"printBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Imprimir</button>\n        <button id=\"exportBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Exportar (.json)</button>\n        <button id=\"resetBtn\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Restablecer</button>\n      </div>\n    </header>\n\n    <!-- Introducci√≥n con el contenido del usuario -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-3\">Introducci√≥n</h2>\n      <p class=\"mb-3\">El viaje hacia un sue√±o reparador y sostenible es una odisea profundamente personal que entrelaza la ciencia del descanso con el arte de vivir consciente. No se trata simplemente de la cantidad de horas que pasamos en la cama, sino de la calidad de ese tiempo, influenciada por un tr√≠ptico de elementos interconectados: nuestros h√°bitos diarios, la gesti√≥n de nuestras emociones y un autoconocimiento profundo.</p>\n    </section>\n\n    <!-- Pilares: H√°bitos / Emociones / Autoconocimiento -->\n    <section class=\"grid lg:grid-cols-3 gap-6 mb-6\">\n      <!-- H√°bitos -->\n      <article class=\"card p-5 md:p-6\">\n        <h3 class=\"text-lg font-semibold\">1) La arquitectura de los h√°bitos</h3>\n        <p class=\"text-sm text-gray-600 mb-3\">Construyendo un santuario para el sue√±o.</p>\n        <ul class=\"list-disc pl-6 text-sm space-y-2\">\n          <li><strong>Rutina de relajaci√≥n pre‚Äësue√±o:</strong> lectura tranquila (sin pantallas), ba√±o/ducha caliente, estiramientos suaves o yoga restaurativo, t√© de hierbas relajantes (manzanilla, valeriana, pasiflora).</li>\n          <li><strong>Horarios regulares:</strong> acostarte y levantarte a la misma hora (tambi√©n fines de semana) para entrenar el reloj interno.</li>\n          <li><strong>Entorno del dormitorio:</strong> oscuridad total (cortinas opacas/antifaz), temperatura fresca (18‚Äì20‚ÄØ¬∞C), silencio (tapones/ruido blanco), colch√≥n y almohadas adecuados.</li>\n          <li><strong>Dieta y ejercicio:</strong> evita cafe√≠na y nicotina por la tarde/noche; modera alcohol; cenas ligeras; ejercicio regular lejos de la hora de dormir.</li>\n        </ul>\n      </article>\n\n      <!-- Emociones -->\n      <article class=\"card p-5 md:p-6\">\n        <h3 class=\"text-lg font-semibold\">2) La danza de las emociones</h3>\n        <p class=\"text-sm text-gray-600 mb-3\">Navegando el paisaje interior.</p>\n        <ul class=\"list-disc pl-6 text-sm space-y-2\">\n          <li><strong>Gesti√≥n del estr√©s:</strong> respiraci√≥n profunda, mindfulness, relajaci√≥n muscular progresiva; diarios de gratitud/preocupaci√≥n; establecer l√≠mites y delegar.</li>\n          <li><strong>Procesamiento emocional:</strong> aceptar/validar; buscar apoyo (amigos/terapia); practicar el perd√≥n.</li>\n          <li><strong>Atenci√≥n plena:</strong> meditaci√≥n guiada espec√≠fica para dormir para bajar la rumiaci√≥n.</li>\n        </ul>\n      </article>\n\n      <!-- Autoconocimiento -->\n      <article class=\"card p-5 md:p-6\">\n        <h3 class=\"text-lg font-semibold\">3) El espejo del autoconocimiento</h3>\n        <p class=\"text-sm text-gray-600 mb-3\">Comprende tu cronotipo y necesidades √∫nicas.</p>\n        <ul class=\"list-disc pl-6 text-sm space-y-2\">\n          <li><strong>Cronotipo:</strong> alondra (madrugador) vs. b√∫ho (noct√°mbulo). Alinea horarios con tus ritmos biol√≥gicos.</li>\n          <li><strong>Se√±ales del cuerpo:</strong> detecta somnolencia, necesidad de siestas y cantidad de sue√±o √≥ptima.</li>\n          <li><strong>Diario de sue√±o:</strong> registra horarios, latencia, despertares y c√≥mo te sientes al d√≠a siguiente.</li>\n          <li><strong>Auto‚Äëcompasi√≥n:</strong> el progreso no es lineal; vuelve al camino con amabilidad.</li>\n        </ul>\n      </article>\n    </section>\n\n    <!-- Integraci√≥n de los tres pilares -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-2\">Integrar los tres pilares en un plan sostenible</h2>\n      <p class=\"text-sm text-gray-700\">H√°bitos conscientes, gesti√≥n emocional proactiva y autoconocimiento continuo se refuerzan entre s√≠. El objetivo es un enfoque personalizado, sostenible y adaptativo.</p>\n    </section>\n\n    <!-- Interactividad: 1) Diagn√≥stico breve de los 3 pilares -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-2\">Diagn√≥stico r√°pido (√∫ltima semana)</h2>\n      <div class=\"grid md:grid-cols-3 gap-6\">\n        <div>\n          <p class=\"text-sm font-medium mb-2\">H√°bitos</p>\n          <div class=\"space-y-2 text-sm\">\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"hb\" value=\"pantallas\"> Dej√© pantallas 60‚Äì90 min antes</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"hb\" value=\"horario\"> Horario regular de sue√±o</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"hb\" value=\"entorno\"> Dormitorio oscuro/fresco/silencioso</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"hb\" value=\"cafeina\"> Sin cafe√≠na tarde / alcohol moderado</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"hb\" value=\"ejercicio\"> Ejercicio regular (no tarde)</label>\n          </div>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium mb-2\">Emociones</p>\n          <div class=\"space-y-2 text-sm\">\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"em\" value=\"respiracion\"> Practiqu√© respiraci√≥n/mindfulness</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"em\" value=\"diario\"> Diario de gratitud o preocupaciones</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"em\" value=\"limites\"> Puse l√≠mites / delegu√©</label>\n            <label class=\"flex items-center gap-2\"><input type=\"checkbox\" class=\"em\" value=\"apoyo\"> Busqu√© apoyo cuando lo necesit√©</label>\n          </div>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium mb-2\">Autoconocimiento</p>\n          <div class=\"space-y-3 text-sm\">\n            <div>\n              <label class=\"block\">Cronotipo estimado</label>\n              <select id=\"cronotipo\" class=\"border rounded-xl px-2 py-1 w-full\">\n                <option value=\"alondra\">Alondra (madrugador/a)</option>\n                <option value=\"intermedio\" selected>Intermedio</option>\n                <option value=\"buho\">B√∫ho (noct√°mbulo/a)</option>\n              </select>\n            </div>\n            <div>\n              <label class=\"block\">Horas ideales de sue√±o</label>\n              <input id=\"horasIdeales\" type=\"number\" min=\"5\" max=\"10\" step=\"0.5\" value=\"7.5\" class=\"border rounded-xl px-2 py-1 w-full\" />\n            </div>\n            <div>\n              <label class=\"block\">Se√±ales corporales hoy (1‚Äì10)</label>\n              <input id=\"somnolencia\" type=\"range\" min=\"1\" max=\"10\" value=\"5\" class=\"w-full\" />\n              <div class=\"text-xs text-gray-500\">Somnolencia actual: <span id=\"somVal\">5</span></div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"mt-4 flex flex-wrap items-center gap-3\">\n        <button id=\"calcDiag\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Calcular diagn√≥stico</button>\n        <div id=\"diagOut\" class=\"text-sm text-gray-700\"></div>\n      </div>\n      <canvas id=\"radarChart\" height=\"130\" class=\"mt-4\"></canvas>\n    </section>\n\n    <!-- Interactividad: 2) Constructor de plan sostenible (7 d√≠as) -->\n    <section class=\"card p-5 md:p-6 mb-6\">\n      <h2 class=\"text-xl font-semibold mb-3\">Constructor de plan sostenible (7 d√≠as)</h2>\n      <p class=\"text-sm text-gray-600 mb-3\">Elige hasta 3 acciones por pilar. Mant√©nlo simple y consistente.</p>\n\n      <div class=\"grid md:grid-cols-3 gap-4\">\n        <div>\n          <p class=\"text-sm font-medium mb-2\">H√°bitos</p>\n          <div id=\"chipsHabitos\" class=\"flex flex-wrap gap-2\"></div>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium mb-2\">Emociones</p>\n          <div id=\"chipsEmociones\" class=\"flex flex-wrap gap-2\"></div>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium mb-2\">Autoconocimiento</p>\n          <div id=\"chipsAuto\" class=\"flex flex-wrap gap-2\"></div>\n        </div>\n      </div>\n\n      <div class=\"grid md:grid-cols-2 gap-4 mt-4\">\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"objetivo\">Objetivo de la semana</label>\n          <input id=\"objetivo\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Ej.: Despertar con +energ√≠a y menos rumiaci√≥n\" />\n        </div>\n        <div>\n          <label class=\"block text-sm font-medium mb-1\" for=\"senal\">Se√±al/recordatorio</label>\n          <input id=\"senal\" class=\"w-full border rounded-xl px-3 py-2\" placeholder=\"Ej.: Recordatorio 21:15 ¬∑ Modo noche\" />\n        </div>\n      </div>\n\n      <div class=\"mt-4 flex flex-wrap items-center gap-3\">\n        <button id=\"genPlan\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Generar plan</button>\n        <span id=\"planStatus\" class=\"text-sm text-gray-500\"></span>\n      </div>\n\n      <div id=\"planOut\" class=\"mt-4 text-sm\"></div>\n    </section>\n\n    <!-- Interactividad: 3) Registro breve diario -->\n    <section class=\"card p-5 md:p-6 mb-10\">\n      <h2 class=\"text-xl font-semibold mb-2\">Registro diario (micro‚Äëcheck)</h2>\n      <div class=\"grid md:grid-cols-4 gap-4 text-sm\">\n        <div>\n          <label class=\"block mb-1\" for=\"fecha\">Fecha</label>\n          <input id=\"fecha\" type=\"date\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n        <div>\n          <label class=\"block mb-1\">Energ√≠a al despertar (1‚Äì10)</label>\n          <input id=\"energia\" type=\"range\" min=\"1\" max=\"10\" value=\"6\" class=\"w-full\" />\n          <div class=\"text-xs text-gray-500\">Valor: <span id=\"enVal\">6</span></div>\n        </div>\n        <div>\n          <label class=\"block mb-1\">√Ånimo (1‚Äì5)</label>\n          <input id=\"animo\" type=\"range\" min=\"1\" max=\"5\" value=\"3\" class=\"w-full\" />\n          <div class=\"text-xs text-gray-500\">Valor: <span id=\"anVal\">3</span></div>\n        </div>\n        <div>\n          <label class=\"block mb-1\">Horas de sue√±o</label>\n          <input id=\"horas\" type=\"number\" min=\"0\" max=\"14\" step=\"0.25\" value=\"7.5\" class=\"w-full border rounded-xl px-3 py-2\" />\n        </div>\n      </div>\n      <div class=\"mt-3 flex flex-wrap items-center gap-3\">\n        <button id=\"guardarDia\" class=\"rounded-xl border px-3 py-2 hover:bg-white\">Guardar</button>\n        <span id=\"saveMsg\" class=\"text-sm text-gray-500\"></span>\n      </div>\n      <canvas id=\"trendChart\" height=\"120\" class=\"mt-4\"></canvas>\n    </section>\n\n    <footer class=\"text-center text-xs text-gray-500 mb-10\">\n      <p>Recurso educativo. Si los problemas persisten, consulta a un/a profesional de la salud. La constancia gana a la perfecci√≥n.</p>\n    </footer>\n  </main>\n\n  <script>\n    const $ = (id)=>document.getElementById(id);\n\n    // ===== Utilidades de estado =====\n    function load(){ try{return JSON.parse(localStorage.getItem('sleepPlanV1'))||{};}catch{return{};} }\n    function save(obj){ localStorage.setItem('sleepPlanV1', JSON.stringify(obj)); }\n\n    // ===== Diagn√≥stico r√°pido =====\n    const ctxRadar = ()=> $('radarChart').getContext('2d');\n    let radar;\n\n    function calcDiagnostico(){\n      const hb = [...document.querySelectorAll('.hb')].reduce((a,el)=> a + (el.checked?1:0), 0);\n      const em = [...document.querySelectorAll('.em')].reduce((a,el)=> a + (el.checked?1:0), 0);\n      const auCrono = $('cronotipo').value; // no punt√∫a, solo etiqueta\n      const auHoras = Number($('horasIdeales').value||7.5);\n      const som = Number($('somnolencia').value||5);\n\n      const habScore = Math.round((hb/5)*100);\n      const emoScore = Math.round((em/4)*100);\n      // autoconocimiento: mejor si tiene horas en 7‚Äì9 y somnolencia <=5\n      let autoScore = 50;\n      if (auHoras>=7 && auHoras<=9) autoScore += 30; else autoScore += 10;\n      autoScore += Math.max(0, (10 - som)*5)/2; // menos somnolencia actual, mejor\n      autoScore = Math.min(100, Math.round(autoScore));\n\n      const labels = ['H√°bitos','Emociones','Autoconocimiento'];\n      const data = [habScore, emoScore, autoScore];\n\n      // Badges\n      const pills = [];\n      pills.push(`<span class='pill ${habScore>=70?'pill-good':'pill-warn'}'>H√°bitos ${habScore}%</span>`);\n      pills.push(`<span class='pill ${emoScore>=70?'pill-good':'pill-warn'}'>Emociones ${emoScore}%</span>`);\n      pills.push(`<span class='pill ${autoScore>=70?'pill-good':'pill-warn'}'>Autoconocimiento ${autoScore}%</span>`);\n      $('diagOut').innerHTML = pills.join(' ');\n\n      if (radar) radar.destroy();\n      radar = new Chart(ctxRadar(), {\n        type: 'radar',\n        data: { labels, datasets:[{ label:'Equilibrio de pilares', data }] },\n        options: { responsive:true, plugins:{ legend:{ display:false } }, scales:{ r:{ suggestedMin:0, suggestedMax:100 } } }\n      });\n\n      const state = load();\n      state.diag = { habScore, emoScore, autoScore, cronotipo: auCrono, horas: auHoras, som };\n      save(state);\n    }\n\n    // ===== Chips de selecci√≥n para el plan =====\n    const HABITOS = ['Pantallas fuera 60‚Äì90 min','Horario regular','Dormitorio oscuro/fresco/silencioso','Cortar cafe√≠na desde 14:00','Cena ligera 3 h antes','Ejercicio suave por la tarde'];\n    const EMOCIONES = ['Respiraci√≥n 4‚Äë6 (3 min)','Mindfulness 5‚Äì10 min','Diario de gratitud (3 √≠tems)','Diario de preocupaciones (5 min)','Pedir apoyo (1 conversaci√≥n)'];\n    const AUTO = ['Alinear hora con cronotipo','Siesta estrat√©gica (<20 min, temprano)','Ajustar horas objetivo (7‚Äì9)','Revisi√≥n de se√±ales corporales','Registro de latencia/despertares'];\n\n    function chip(text){\n      const s = document.createElement('span');\n      s.className = 'chip'; s.textContent = text;\n      s.addEventListener('click',()=> s.classList.toggle('chip-active'));\n      return s;\n    }\n\n    function renderChips(){\n      const H = $('chipsHabitos'); const E = $('chipsEmociones'); const A = $('chipsAuto');\n      H.innerHTML=''; E.innerHTML=''; A.innerHTML='';\n      HABITOS.forEach(x=> H.appendChild(chip(x)));\n      EMOCIONES.forEach(x=> E.appendChild(chip(x)));\n      AUTO.forEach(x=> A.appendChild(chip(x)));\n    }\n\n    function generarPlan(){\n      const take = (id)=> [...$(id).children].filter(c=>c.classList.contains('chip-active')).map(c=>c.textContent).slice(0,3);\n      const h = take('chipsHabitos');\n      const e = take('chipsEmociones');\n      const a = take('chipsAuto');\n      const objetivo = $('objetivo').value.trim() || 'Dormir mejor de forma sostenible';\n      const senal = $('senal').value.trim() || 'Recordatorio 21:30 + modo noche';\n      if (h.length===0 && e.length===0 && a.length===0){ $('planStatus').textContent='Selecciona al menos 1 acci√≥n.'; return; }\n\n      const days = ['Lun','Mar','Mi√©','Jue','Vie','S√°b','Dom'];\n      const rows = days.map((d,i)=>{\n        const pick = [ h[i%Math.max(1,h.length)||1-1], e[i%Math.max(1,e.length)||1-1], a[i%Math.max(1,a.length)||1-1] ].filter(Boolean).join(' ¬∑ ');\n        return `<tr><td class='px-3 py-2 border'>${d}</td><td class='px-3 py-2 border'>${pick}</td><td class='px-3 py-2 border'>${senal}</td></tr>`;\n      }).join('');\n\n      $('planOut').innerHTML = `\n        <div class='border rounded-xl overflow-hidden'>\n          <div class='px-4 py-2 bg-gray-50 border-b text-sm'><strong>Objetivo:</strong> ${objetivo}</div>\n          <table class='w-full text-sm'>\n            <thead class='bg-gray-50'><tr><th class='px-3 py-2 text-left border'>D√≠a</th><th class='px-3 py-2 text-left border'>Acciones</th><th class='px-3 py-2 text-left border'>Se√±al</th></tr></thead>\n            <tbody>${rows}</tbody>\n          </table>\n        </div>`;\n\n      $('planStatus').textContent = 'Plan generado ‚úîÔ∏è';\n\n      const state = load();\n      state.plan = { objetivo, senal, h, e, a };\n      save(state);\n    }\n\n    // ===== Registro diario + tendencias =====\n    let lineChart;\n    function guardarDia(){\n      const fecha = $('fecha').value; if(!fecha){ alert('Elige una fecha.'); return; }\n      const energia = Number($('energia').value||0);\n      const animo = Number($('animo').value||0);\n      const horas = Number($('horas').value||0);\n      const state = load();\n      if(!state.entries) state.entries = [];\n      const idx = state.entries.findIndex(e=> e.fecha===fecha);\n      const rec = { fecha, energia, animo, horas };\n      if(idx>=0) state.entries[idx]=rec; else state.entries.push(rec);\n      save(state);\n      $('saveMsg').textContent = 'Guardado ‚úîÔ∏è'; setTimeout(()=> $('saveMsg').textContent='', 1500);\n      plotTrends();\n    }\n\n    function plotTrends(){\n      const state = load(); const data = (state.entries||[]).sort((a,b)=> a.fecha.localeCompare(b.fecha)).slice(-14);\n      const labels = data.map(x=>x.fecha);\n      const horas = data.map(x=>x.horas);\n      const energia = data.map(x=>x.energia);\n      const animo = data.map(x=>x.animo);\n      const ctx = $('trendChart').getContext('2d');\n      if(lineChart) lineChart.destroy();\n      lineChart = new Chart(ctx, {\n        type: 'line',\n        data: { labels, datasets:[\n          { label:'Horas de sue√±o', data: horas, tension:0.3 },\n          { label:'Energ√≠a (1‚Äì10)', data: energia, tension:0.3 },\n          { label:'√Ånimo (1‚Äì5)', data: animo, tension:0.3 }\n        ] },\n        options: { responsive:true, plugins:{ legend:{ position:'bottom' } }, scales:{ y:{ beginAtZero:true } } }\n      });\n    }\n\n    // ===== Exportar / Reset =====\n    function exportJSON(){\n      const data = load();\n      const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a'); a.href=url; a.download='plan_sueno_sostenible.json'; a.click(); URL.revokeObjectURL(url);\n    }\n\n    function resetAll(){\n      if(!confirm('¬øRestablecer todo el recurso?')) return;\n      localStorage.removeItem('sleepPlanV1');\n      renderChips();\n      $('objetivo').value=''; $('senal').value='';\n      $('diagOut').innerHTML='';\n      if(radar) radar.destroy(); if(lineChart) lineChart.destroy();\n      $('planOut').innerHTML=''; $('planStatus').textContent='';\n      $('fecha').value=''; $('energia').value=6; $('animo').value=3; $('horas').value=7.5;\n      $('enVal').textContent='6'; $('anVal').textContent='3';\n    }\n\n    // ===== Eventos =====\n    $('calcDiag').addEventListener('click', calcDiagnostico);\n    $('genPlan').addEventListener('click', generarPlan);\n    $('guardarDia').addEventListener('click', guardarDia);\n    $('exportBtn').addEventListener('click', exportJSON);\n    $('printBtn').addEventListener('click', ()=>window.print());\n    $('resetBtn').addEventListener('click', resetAll);\n\n    $('somnolencia').addEventListener('input', ()=> $('somVal').textContent = $('somnolencia').value);\n    $('energia').addEventListener('input', ()=> $('enVal').textContent = $('energia').value);\n    $('animo').addEventListener('input', ()=> $('anVal').textContent = $('animo').value);\n\n    // ===== Inicio =====\n    function init(){\n      renderChips();\n      plotTrends();\n      // restaurar estado si existe\n      const state = load();\n      if(state.diag){\n        $('cronotipo').value = state.diag.cronotipo || 'intermedio';\n        $('horasIdeales').value = state.diag.horas || 7.5;\n        $('somnolencia').value = state.diag.som || 5; $('somVal').textContent = state.diag.som || 5;\n        $('diagOut').innerHTML = '';\n      }\n      if(state.plan){\n        $('objetivo').value = state.plan.objetivo || '';\n        $('senal').value = state.plan.senal || '';\n        // marcar chips elegidos tras render\n        setTimeout(()=>{\n          [...$('chipsHabitos').children].forEach(ch=>{ if(state.plan.h?.includes(ch.textContent)) ch.classList.add('chip-active'); });\n          [...$('chipsEmociones').children].forEach(ch=>{ if(state.plan.e?.includes(ch.textContent)) ch.classList.add('chip-active'); });\n          [...$('chipsAuto').children].forEach(ch=>{ if(state.plan.a?.includes(ch.textContent)) ch.classList.add('chip-active'); });\n        }, 0);\n      }\n    }\n\n    function renderChips(){\n      const wrapH = $('chipsHabitos'); const wrapE = $('chipsEmociones'); const wrapA = $('chipsAuto');\n      wrapH.innerHTML=''; wrapE.innerHTML=''; wrapA.innerHTML='';\n      HABITOS.forEach(x=> wrapH.appendChild(chip(x)));\n      EMOCIONES.forEach(x=> wrapE.appendChild(chip(x)));\n      AUTO.forEach(x=> wrapA.appendChild(chip(x)));\n    }\n\n    init();\n  </script>\n</body>\n</html>\n"
          ]
        },
        {
          "id": "m5a2",
          "title": "Video Resumen ",
          "description": "recordemos lo que hemos visto ",
          "type": "video",
          "videoSrc": assetPath('videos/higiene-sueno_mod5.mp4')
        }
      ]
    }
  ]
};

export default course;
